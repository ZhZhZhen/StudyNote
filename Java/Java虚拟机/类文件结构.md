# 类文件结构
- 结构
    - Class文件是一组8个bit(1字节)为基础单位的二进制流，当遇到占用8bit以上的空间的数据项时，则会按照高位在前的方式分割成若干个8bit进行存储。由无符号数和表组成，下面内容按顺序排列
        - 无符号数有u1、u2、u4、u8代表占用接下来1、2、4、8个字节。
        - 表描述层次结构，表里面也是由无符号数和表组成（Class文件本质上可视作一张表）
        - 一系列的集合（比如一系列的表）之前会有一个容器计数器表示数量
    - 1、每个Class文件头4个字节为魔数，唯一作用为确定是否能被虚拟机接收的Class文件，固定为“CAFEBABE”;第5、6个字节为Class文件次版本号；7、8个字节为Class文件主版本号(虚拟机被定义为无论如何拒绝执行超过其版本号的Class的文件)
    - 2、常量池入口，2位用于表示常量池的容器计数器(从1开始，0表示不引用任何一个常量池，如27，表示1~27)。常量池存放字面量(常量)、符号引用
        - 符号引用：被模块导出或开放的包、类和接口的全限定名、字段的名称和描述符、方法的名称和描述符、方法句柄和方法类型、动态调用点和动态常量。符号引用也是用表来描述，内容指向更加基本的信息
        - 常量池每一项常量都是一个表，表结构的起始第一位是一个u1类型的标志位，代表当前项是哪种常量类型。
    - 3、2位访问标志（access_flags），用于表示是类还是接口，是否public，是否abstract，是否final
    - 4、类索引（u2,指向常量池对应位置）、父类索引（u2,指向常量池对应位置）、接口索引集合（u2表示接口计数器，后跟常量池对应位置的集合）。常量池对应位置为类或接口的全限定名。从这里也可以看出Java单继承多实现。
    - 5、字段表集合，一开始u2表示字段表计数器，用于描述接口或类中声明的变量（字段表可能出现代码未设定的值，如内部类对外部类的引用会被添加）
        - u2表示字段访问标志（access_flags）
        - u2表示字段简单名称（代码定义的名称，如int num，简单名称就是num（Java不允许不同描述符有相同名称，但是Class文件是运行的）
        - u2表示字段的描述符（描述字段的数据类型，方法的参数列表和返回值）
            - 基本数据类型为其第一个大写字母如byte-B，char-C，void-V，对象-L后紧跟对象全限定名
            - 数组类型使用前置[表示，几个[表示几维度，如char[][]对应[[C
            - 方法签名被描述为(顺序表示各参数类型)返回类型，如void methodA(int a, long b) 对应(IL)V
        - 可能有一个属性表集合用于存储额外信息，字段表可在此附加0~n项额外信息。例如出现常量，这里会有属性ConstantValue
    - 6、方法表集合，一开始u2表示方法表计数器，内容与字段表几乎一致
        - u2访问标志（access_flags），因为方法没有volatile和transient修饰，增加了native,synchronized,strictfp,abstract，相比字段有变动
        - u2名称索引，如methodA()对应methodA，构造方法对应<init>
        - u2描述符
        - 属性表集合，存放有关与方法的额外属性，例如 存放方法代码的属性Code
    - 属性表集合 (知识扩展，位于多个地方出现，如上述字段和方法)
        - Class文件、字段、方法表可以携带自己的属性表。由属性名做标识(u2指向常量池中的字符串常量，类似于 常量标识，这里使用的是字符串做标识)，后跟长度(u4表示)，内容(由长度限定)
        - Code属性：用于方法表的属性表，表示代码的最大操作数栈数，最大局部变量槽，字节码操作符，异常表(用于描述方法中的try-catch)
        - Exception属性：用于方法表的属性表（需要与Code属性的异常表区分），用来表示方法抛出的异常集合
        - 还有很多属性表，也可以自定义属性表，Java虚拟器会对不识别的属性表默认不处理
- 扩展知识
    - 使用javac命令将Java文件编译成class文件，使用java命令运行class文件
    - Android使用dx命令把class文件转化为dex文件，使用cp文件运行dex文件