# 跨进程更新视图
- 桌面小部件
    - 基于广播来接收跨进程消息，通过AppWidgetManager跨进程更新小部件视图
    - 实现小部件需要继承AppWidgetProvider，并通过广播的注册方式注册在Manifest中，该类继承至BroadcastReceiver。系统进程会通过广播向App发送消息，在onReceive()中会分别根据广播类型回调onEnable()，onUpdate()，onDeleted()，onDisabled()，或自定义函数（想要回调对应的方法，就需要在注册广播时注册对应的action去过滤intent）
    - 客户端使用AppWidgetManager，传递RemoteViews来更新小部件，RemoteView还支持设置PendingIntent来设置点击出发行为
- PendingIntent
    - 用于发送一个意图，用于稍后启动Activity，Service，发送广播
    - 如果两个PendingIntent内部Intent相同，且requestCode相同，则被认为是相同的；两个Intent中如果ComponentName和intentFilter相同，则被认为是相同。(Intent的extra不参与匹配)
    - Flag（相同的PendingIntent会根据不同的Flag产生不同效果）：1、FLAG_ONE_SHOW，只能被使用一次，使用后，相同已存在的PI(PendingIntent)会取消，后续的会无法send；2、FLAG_NO_CREATE，系统不存在相同PI时，将获取失败(获取已经创建的PI？)；3、FLAG_CANCEL_CURRENT，创建新的PI时会取消相同已存在的PI；4、FLAG_UPDATE_CURRENT，创建新的PI时会将相同已存在的PI更新至最新的一模一样(可以用于更新Intent的extra)
- RemoteViews
    - 用于跨进程传输视图信息和视图更新操作的信息，只支持更新常用的View，自定义View不支持
    - 构造方法传递的布局id和包名，用于SystemService获取资源文件；然后使用setXXX方法内部通过addAction()添加对应Action更新View的操作。
    - setXXX()：RemoteViews内部维护mActions（ArrayList）来记录Action，该方法创建Action并通过setAction()添加至mAction中
    - Apply()：由SystemService端调用，通过inflater去创建布局，并调用performApply来循环调用 Action.app ly()完成更新
    - *其余知识：1、 setPendingIntentTemplate和setOnClickFillInIntent组合使用用于集合View的点击监听，比如ListView。2、 Action.app ly()有时通过反射实现View的方法调用，有时候是直接调用，这对应于不同的Action。