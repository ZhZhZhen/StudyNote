# Android虚拟机
- 用于Android平台的Java虚拟机，支持dex格式的java应用程序的运行。一个进程对应一个Android虚拟机。
- 与普通JVM的区别
    - 基于寄存器的指令。该寄存器由内存实现，但是与机器的寄存器相关联，所以提升了指令的计算速度。
    - Android虚拟机运行的是.dex文件，该文件由dx工具将所有的.class文件转换为一个.dex文件，虚拟机再从中读取指令和数据。这样做减少了整体的尺寸和I/O次数，提高了类的查找速度。
    - dx工具对所有的.class文件常量池分解，消除了其中的冗余信息，重新组合形成一个常量池，所有的类文件共享同一个常量池。使得相同的常量(应该是符号引用等的字面量?)只在.dex文件中出现一次，减少了文件体积。(所有的class文件在dx命令下会转化为一个dex文件，该dex文件记录所有的class文件信息，所以冗余部分被消除了)
- Java到Android程序过程
    - 把Java源文件编译成.class文件(javac命令)
    - 使用dx工具把.class文件转换成.dex文件(dx命令)
    - 使用 aapt 工具把 .dex 文件、资源文件以及 AndroidManifest.xml 文件组合成APK
    - 将 APK 安装到 Android 设备运行
- ART虚拟机(Android4.4之后开始使用)和Dalvik虚拟机
    - Dalvik虚拟机：在应用启动的时候使用JIT（动态编译）把.dex转换为机器码，因为65536最大方法数的限制，所以有一个合包的过程。导致冷启动很慢。
    - ART虚拟机特点：兼容Dalvik特性，并把.dex文件转化为机器码这个步骤提前到了应用安装的时候，在安装过程使用AOT（静态编译）将.dex转化为虚拟机可执行的机器码，ART运行机器码，所以不会有多dex的合包过程，因此提升了冷启动时间，避免了65536问题
    - ART优点：1、加快App冷启动时间。2、提升GC速度（标记时锁定堆，导致阻塞所有线程，清除时并行清除，Dalvik标记和清除都会阻塞线程）。3、提供功能更全面的Debug特性。
    - ART缺点：1、安装速度慢。2、APK安装后占用空间大。(这两点都是因为生成了.oat文件)
- app安装目录
    - 在/data/app/下，dex文件会被扫描到/data/dalvik-cache/目录下(dex2oat优化产物的目录)